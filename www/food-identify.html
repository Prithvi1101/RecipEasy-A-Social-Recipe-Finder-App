<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Identify Food - RecipEasy</title>
  <link rel="stylesheet" href="auth-style.css" />
  <style>
    body {
      background: url('bg-img.png') no-repeat center center fixed;
      background-size: cover;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      padding: 0;
      font-family: 'Poppins', sans-serif;
    }

    .post-container {
      background: rgba(255, 255, 255, 0.95);
      padding: 2em;
      border-radius: 15px;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
    }

    h2 {
      text-align: center;
      margin-bottom: 1em;
    }

    input[type="file"] {
      width: 100%;
      padding: 0.7em;
      margin-bottom: 1em;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    .submit-btn {
      width: 100%;
      background: #f4c531;
      color: white;
      border: none;
      padding: 0.9em;
      font-weight: bold;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .submit-btn:hover {
      background-color: #d4b420;
    }

    .back-btn {
      background-color: #ccc;
      color: #333;
      padding: 0.5em 1em;
      font-weight: bold;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-bottom: 1em;
    }

    .back-btn:hover {
      background-color: #bbb;
    }

    #result {
      margin-top: 1em;
      background: #fff;
      padding: 1em;
      border-radius: 10px;
      white-space: pre-wrap;
      font-size: 0.95em;
      color: #333;
      max-height: 300px;
      overflow-y: auto;
    }

    #image-preview img {
      width: 100%;
      border-radius: 10px;
      margin-top: 1em;
    }
  </style>
</head>
<body>

  <div class="post-container">
    <button class="back-btn" onclick="goBack()">üîô Back</button>
    <h2>Snap & Identify Food</h2>
    <input type="file" id="file-input" accept="image/*" />
    <button class="submit-btn" onclick="identifyFood()">Identify</button>
    <div id="image-preview"></div>
    <div id="result"></div>
  </div>

  <script>
    function goBack() {
      if (window.history.length > 1) {
        window.history.back();
      } else {
        window.location.href = "dashboard.html";
      }
    }

    async function identifyFood() {
  const fileInput = document.getElementById("file-input");
  const file = fileInput.files[0];
  const resultDiv = document.getElementById("result");
  const previewDiv = document.getElementById("image-preview");

  if (!file) return alert("Please upload a food photo.");

  if (file.size > 5 * 1024 * 1024) {
    alert("File too large. Max 5MB allowed.");
    return;
  }

  const reader = new FileReader();
  reader.onload = async function () {
    const base64Data = reader.result.split(',')[1];
    previewDiv.innerHTML = `<img src="${reader.result}" />`;
    resultDiv.innerText = "‚è≥ Identifying food... Please wait.";

    try {
      const API_KEY = "YOUR GOOGLE API KEY";
      const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${API_KEY}`;

      const prompt = `
Look at the image.
If it's NOT a food photo, reply with:
"‚ùå Please upload a food photo."

Otherwise, describe it like this:

üçΩÔ∏è **Dish Name**: [dish name]  
üìã **Ingredients**:  
- [item 1]  
- [item 2]  
...  
üë®‚Äçüç≥ **Cooking Method**: [brief friendly cooking instructions]  
üì∫ **Watch on YouTube**: Include a YouTube search link for how to make this dish.  
`;

      const payload = {
        contents: [
          {
            parts: [
              { text: prompt },
              {
                inlineData: {
                  mimeType: file.type,
                  data: base64Data
                }
              }
            ]
          }
        ]
      };

      const response = await fetch(API_URL, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      });

      const data = await response.json();
      const message = data?.candidates?.[0]?.content?.parts?.[0]?.text || "‚ùå No result from Gemini.";
   let formatted = message
  .replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>") // Bold markdown
  .replace(/\n/g, "<br>") // Line breaks
  .replace(/üì∫\s*Watch on YouTube:.*?<br>?/g, '') // Remove the Watch on YouTube line
  .replace(/\[https:\/\/www\.youtube\.com\/results\?search_query=.*?\]/g, '') // Remove [YouTube URL]
  .replace(/https:\/\/www\.youtube\.com\/results\?search_query=[^\s<]+/g, (url) => {
    return `<br><a href="${url}" target="_blank">
      <button style="margin-top:10px; background-color:#f4c531; color:white; border:none; padding:20px 20px; border-radius:8px; font-weight:bold; cursor:pointer;">
        ‚ñ∂Ô∏è Watch on YouTube
      </button>
    </a>`;
  });



resultDiv.innerHTML = formatted;

    } catch (err) {
      console.error(err);
      resultDiv.innerText = "‚ùå Error identifying food. Please try again.";
    }
  };

  reader.readAsDataURL(file);
}

  </script>
</body>
</html>
